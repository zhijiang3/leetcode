# Power of Four

> 题目地址: [https://leetcode-cn.com/problems/power-of-four/](https://leetcode-cn.com/problems/power-of-four/)

## 题目描述

给定一个整数 (32 位有符号整数)，请编写一个函数来判断它是否是 4 的幂次方。

示例 1:

```
输入: 16
输出: true
```

示例 2:

```
输入: 5
输出: false
```

**进阶：**
你能不使用循环或者递归来完成本题吗？

------

## 题解

> 算法参考：https://leetcode-cn.com/problems/power-of-four/solution/4de-mi-by-leetcode/

### 方法一：数学运算

如果数字 4 的幂 $4^{a}=n$，则

$$
\begin{aligned}
a &= \log_{4} n &(对数形式) \\\\
  &= \frac{\log_{2} n}{\log_{2} 4} &(换底公式) \\\\
  &= \frac{1}{2}\log_{2} n
\end{aligned}
$$

应为整数，那么我们检查 $\log_2 n$ 是否为偶数就能判断 `n` 是否为 4 的幂。

#### 代码实现

```js
function isPowerOfFour(n) {
  return n > 0 && Math.log2(n) % 2 === 0;
}
```

#### 复杂度分析

* 时间复杂度：$ O(1) $.
* 空间复杂度：$ O(1) $.

### 方法二：位操作

首先检查 n 是否为 2 的幂：`n > 0 and n & (n - 1) == 0`，接着需要区分 2 的**奇数幂和偶数幂**：

```
2 的偶数幂，n 是 4 的幂
-------------------------------
n = 1     |   0 0 0 0 0 0 0 1
n = 4     |   0 0 0 0 0 1 0 0
n = 16    |   0 0 0 1 0 0 0 0
n = 64    |   0 1 0 0 0 0 0 0
-------------------------------
2 的奇数幂，n 不是 4 的幂
-------------------------------
n = 2     |   0 0 0 0 0 0 1 0
n = 8     |   0 0 0 0 1 0 0 0
n = 32    |   0 0 1 0 0 0 0 0
n = 128   |   1 0 0 0 0 0 0 0
```

不难看出，2 的偶数幂其二进制位为 1 的数都位于奇数位（第1位、第3位、第5位...），2 的奇数幂其二进制位为 1 的数都位于偶数位（第2位、第4位、第6位）。

因此，用 `10101010101010101010101010101010` (偶数位都为 1) 和数字 `n` 做**按位与**操作，如果为 0 那么 `n` 为 4 的幂。

#### 代码实现

```js
function isPowerOfFour(n) {
  return n > 0 && (n & (n - 1)) === 0 && (0xaaaaaaaa & n) === 0;
}
```

#### 复杂度分析

* 时间复杂度：$ O(1) $.
* 空间复杂度：$ O(1) $.

### 方法三：数学运算 + 位操作

首先检查 n 是否为 2 的幂：`n > 0 and n & (n - 1) == 0`，然后可以确定 $n = 2^{a}$，若 `n` 为 4 的幂，则 `a` 为偶数。

考虑 `a` 的两种情况：

$$
a = \begin{cases}
2k     & a \in 偶数 \\\\
2k + 1 & a \in 奇数
\end{cases}
$$

再对 n 模 3，即 $n \mod 3 = 2^a \mod 3$，把 `a` 带入可得：

$$
n \mod 3 = \begin{cases}
2^{2k} \mod 3     & (偶数的情况)\\\\
2^{2k + 1} \mod 3 & (奇数的情况)
\end{cases}
$$

对式子化简，得到：

$$
n \mod 3 = \begin{cases}
1 & (偶数的情况)\\\\
2 & (奇数的情况)
\end{cases}
$$

若 `n` 为 2 的幂且 `n % 3 == 1`，则 `n` 为 4 的幂。

#### 代码实现

```js
function isPowerOfFour(n) {
  return n > 0 && (n & (n - 1)) === 0 && n % 3 === 1;
}
```

#### 复杂度分析

* 时间复杂度：$ O(1) $.
* 空间复杂度：$ O(1) $.

#### mod 的计算过程

我们通过计算 $n = 2^{2k} \mod 3$ 来理解：

1. 首先 $2^{2k} = {2^2}^k = 4^k$，且 $4 = 3 + 1$
2. 则 $n = 2^{2k} \mod 3$ 可以写为 $n = (3 + 1)^k \mod 3$
3. 进行分解：$(3 + 1)^k = (3 + 1) \times (3 + 1)^{k - 1} = 3 \times (3 + 1)^{k - 1} + (3 + 1)^{k - 1}$
4. 且 $3 \times (3 + 1)^{k - 1} \mod 3 = 0$，则我们可以变换得 $n = (3 + 1)^{k - 1} \mod 3$
5. 重复 **步骤3** 和 **步骤4**，使得 `k -> (k - 1) -> (k - 2) -> ... -> 1`，得到最终式子：$n = (3 + 1)^1 \mod 3 = 1$
